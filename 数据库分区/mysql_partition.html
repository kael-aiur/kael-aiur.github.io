<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang="zh_CN">
  <head>
  	<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="chrome=1" />
    <link rel="stylesheet" type="text/css" href="../css/base/base.css" media="screen" />
    <link rel="stylesheet" type="text/css" href="../css/common/markdown.css" media="screen" />
    <link rel="stylesheet" type="text/css" href="../css/common/common.css" media="screen" />
    <link rel="stylesheet" type="text/css" href="../css/pages/index.css" media="screen" />
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <title>mysql分区及实例演示</title>
  </head>

  <body>
  	<div class="header">
  		<div class="logo" >
  			<img src="../images/kael.jpg" alt="kael" />
  			<span>Kael的个人网站</span>
  		</div>
  		
  	</div>
  	<div class="body">
  		<div class="author-content">
  			<div class="avatar">
  				<img src="../images/kael.jpg" alt="kael" />
  			</div>
  			<div class="avatar-name">Kael-aiur</div>
  			<div class="avatar-introduce">
  				<p>
  					&nbsp;&nbsp;我是一个java的web全栈开发人员，做这个网站主要的想法是用来转载自己在网上看到的一些自己比较喜欢的资料，当然也欢迎大家来这里看我转载的资料
  				</p>
  			</div>
  		</div>
  		<div class="body-content">
  			<div class="title">目录</div>
  			<hr />
  			<div class="content">
  				<h1 id="mysql">mysql分区及实例演示</h1>
<h2>一、为什么要分区？</h2>
<p>需求：大数据。解决方案：分而治之，更细一点即为。将大表和大索引分为一个更小的操作单元<br />
在mysql中，分区允许将表、索引和索引编排表细分为更小的单元。分区后，每个分区有自己单独的名称。对于DBA来讲，这些分区可以统一管理，也可以分开管理。<br />
但是对于应用程序来讲，分区的表和没有分区的表示一样的。换句话来讲，分区对于应用是透明的，只是数据库对于数据的重新整理。<br />
Mysql分区，这个是mysql对于分区的官方解释。</p>
<h3>1.分区的作用</h3>
<p>a)提升性能</p>
<p>应该说，几乎所有分区的目的都是用来提升性能的。不是谁哪天早上吃着鸡蛋灌饼，说咱们分个区玩玩吧！不是的。那么分区是如何来提升检索数据的性能的呢？没有分区之前，数据每次在查询和检索总是面向的是整个数据库和表。分区之后，mysql针对每个分区生成特定的数据文件与索引文件。每次只会检索特定的部分数据，因此可以更好的来执行和维护数据库。究其原因还是因为在分区之后表指派到不同的物理驱动器上，这样便可在同时访问多个分区时减少物理 I/O 争用。<br />
b)易于管理<br />
对于一些无用的冗余的历史数据来讲，可以根据分区之后直接删除相应的分区。操作起来更加简便，因为执行数以万计的数据远比直接删除文件来的困难的多、时间也更加的长。<br />
c)容错<br />
分区之后相比分区之前，一张表从之前一个文件分为现在的三个文件。分区之后即使一个文件出现破坏，也不会影响其他数据。</p>
<h3>2.常用分区方法</h3>
<p>RANGE分区<br />
LIST分区<br />
HASH分区<br />
KEY分区</p>
<h2>二、如何分区？</h2>
<h3>1.查看数据库是否支持分区</h3>
<div class="sourceCode"><pre class="sourceCode sql"><code class="sourceCode sql">SHOW VARIABLES <span class="kw">LIKE</span> <span class="st">&#39;%partition%&#39;</span>;</code></pre></div>
<p><img src="img/1.jpg" alt="img/1.jpg" /></p>
<p>对于mysql来讲，现阶段支持分区操作的版本有5.1和5.5.如图显示为YES则表明该数据库支持分区操作。</p>
<h3>2.四种常见分区</h3>
<h4 id="range">Range分区</h4>
<p>俗称：范围分区。根据表的字段的值，依据给定某段连续的区间来分区。</p>
<p>直接创建表时分区</p>
<div class="sourceCode"><pre class="sourceCode sql"><code class="sourceCode sql"><span class="kw">create</span> <span class="kw">table</span> teacher
(<span class="kw">id</span> <span class="dt">varchar</span>(<span class="dv">20</span>) <span class="kw">not</span> <span class="kw">null</span> ,
name <span class="dt">varchar</span>(<span class="dv">20</span>),
age <span class="dt">varchar</span>(<span class="dv">20</span>),
birthdate <span class="dt">date</span> <span class="kw">not</span> <span class="kw">null</span>,
salary <span class="dt">int</span>
)
<span class="kw">partition</span> <span class="kw">by</span> <span class="kw">range</span>(<span class="dt">year</span>(birthdate))
(
<span class="kw">partition</span> p1 <span class="kw">values</span> <span class="kw">less</span> <span class="kw">than</span> (<span class="dv">1970</span>),
<span class="kw">partition</span> p2 <span class="kw">values</span> <span class="kw">less</span> <span class="kw">than</span> (<span class="dv">1990</span>),
<span class="kw">partition</span> p3 <span class="kw">values</span> <span class="kw">less</span> <span class="kw">than</span> <span class="kw">maxvalue</span>
);</code></pre></div>
<p>Ps：创建teacher表，并在创建teacher表同时根据birthdate字段将表划分为p1、p2、p3三个分区。</p>
<p>在创建表后分区</p>
<div class="sourceCode"><pre class="sourceCode sql"><code class="sourceCode sql"><span class="kw">ALTER</span> <span class="kw">TABLE</span> teacher 
<span class="kw">partition</span> <span class="kw">by</span> <span class="kw">range</span>(<span class="dt">year</span>(birthdate))
(
<span class="kw">partition</span> p1 <span class="kw">values</span> <span class="kw">less</span> <span class="kw">than</span> (<span class="dv">1970</span>),
<span class="kw">partition</span> p2 <span class="kw">values</span> <span class="kw">less</span> <span class="kw">than</span> (<span class="dv">1990</span>),
<span class="kw">partition</span> p3 <span class="kw">values</span> <span class="kw">less</span> <span class="kw">than</span> <span class="kw">maxvalue</span>
);</code></pre></div>
<p>Ps：给已经创建了的表分区，分为p1、p2、p3.</p>
<h4 id="list">LIST分区</h4>
<p>俗名：列表分区。其实list分区和range分区应该说都是一样的，不同的是range分区在分区是的依据是一段连续的区间；而list分区针对的分区依据是一组分布的散列值。</p>
<div class="sourceCode"><pre class="sourceCode sql"><code class="sourceCode sql"><span class="kw">create</span> <span class="kw">table</span> student
 (<span class="kw">id</span> <span class="dt">varchar</span>(<span class="dv">20</span>) <span class="kw">not</span> <span class="kw">null</span> ,
 studentno <span class="dt">int</span>(<span class="dv">20</span>) <span class="kw">not</span> <span class="kw">null</span>,
 name <span class="dt">varchar</span>(<span class="dv">20</span>),
 age <span class="dt">varchar</span>(<span class="dv">20</span>)
 )
 <span class="kw">partition</span> <span class="kw">by</span> <span class="kw">list</span>(studentno)
 (
 <span class="kw">partition</span> p1 <span class="kw">values</span> <span class="kw">in</span> (<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>),
 <span class="kw">partition</span> p2 <span class="kw">values</span> <span class="kw">in</span>  (<span class="dv">5</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">8</span>),
 <span class="kw">partition</span> p3 <span class="kw">values</span> <span class="kw">in</span> (<span class="dv">9</span>,<span class="dv">10</span>,<span class="dv">11</span>)
 );</code></pre></div>
<p>Ps：如上创建表student，并将student表分为p1、p2、p3三个分区。需要注意的是一般情况下，针对表的分区字段为int等数值类型。</p>
<h4 id="hash">HASH分区</h4>
<p>小名：哈希分区。哈希分区主要是依据表的某个字段以及指定分区的数量。</p>
<div class="sourceCode"><pre class="sourceCode sql"><code class="sourceCode sql"><span class="kw">create</span> <span class="kw">table</span> <span class="fu">user</span> (
  <span class="kw">id</span> <span class="dt">int</span>(<span class="dv">20</span>) <span class="kw">not</span> <span class="kw">null</span>,
  <span class="kw">role</span> <span class="dt">varchar</span>(<span class="dv">20</span>) <span class="kw">not</span> <span class="kw">null</span>,
  description <span class="dt">varchar</span>(<span class="dv">50</span>) 
)
<span class="kw">partition</span> <span class="kw">by</span> <span class="kw">hash</span>(<span class="kw">id</span>) 
<span class="kw">partitions</span> <span class="dv">10</span>;</code></pre></div>
<p>Ps:如上创建user表，并将user表平均分为十个分区。比较有限制的就是需要知道表的数据有多少才能更好平均分配分区。</p>
<h4 id="key">key分区</h4>
<p>类似于按HASH分区，区别在于KEY分区只支持计算一列或多列，且MySQL服务器提供其自身的哈希函数。必须有一列或多列包含整数值。</p>
<div class="sourceCode"><pre class="sourceCode sql"><code class="sourceCode sql"><span class="kw">create</span> <span class="kw">table</span> <span class="kw">role</span>( <span class="kw">id</span> <span class="dt">int</span>(<span class="dv">20</span>) <span class="kw">not</span> <span class="kw">null</span>,name <span class="dt">varchar</span>(<span class="dv">20</span>) <span class="kw">not</span> <span class="kw">null</span>)
<span class="kw">partition</span> <span class="kw">by</span> linear <span class="kw">key</span>(<span class="kw">id</span>)
<span class="kw">partitions</span> <span class="dv">10</span>;</code></pre></div>
<h3>3.分区表管理</h3>
<p>对指定表添加分区</p>
<div class="sourceCode"><pre class="sourceCode sql"><code class="sourceCode sql"><span class="kw">alter</span> <span class="kw">table</span> <span class="fu">user</span> <span class="kw">add</span> <span class="kw">partition</span>(<span class="kw">partition</span> p4 <span class="kw">values</span> <span class="kw">less</span> <span class="kw">than</span> <span class="kw">MAXVALUE</span>);</code></pre></div>
<p>删除指定表指定分区</p>
<div class="sourceCode"><pre class="sourceCode sql"><code class="sourceCode sql"><span class="kw">alter</span> <span class="kw">table</span> student <span class="kw">drop</span> <span class="kw">partition</span> p1;</code></pre></div>
<p>创建子分区</p>
<div class="sourceCode"><pre class="sourceCode sql"><code class="sourceCode sql"><span class="kw">create</span> <span class="kw">table</span> role_subp(<span class="kw">id</span> <span class="dt">int</span>(<span class="dv">20</span>) <span class="kw">not</span> <span class="kw">null</span>,name <span class="dt">int</span>(<span class="dv">20</span>) <span class="kw">not</span> <span class="kw">null</span>)
<span class="kw">partition</span> <span class="kw">by</span> <span class="kw">list</span>(<span class="kw">id</span>)
<span class="kw">subpartition</span> <span class="kw">by</span> <span class="kw">hash</span>(name)
<span class="kw">subpartitions</span> <span class="dv">3</span>
(
  <span class="kw">partition</span> p1 <span class="kw">values</span> <span class="kw">in</span>(<span class="dv">10</span>),
  <span class="kw">partition</span> p2 <span class="kw">values</span> <span class="kw">in</span>(<span class="dv">20</span>)
)</code></pre></div>
<p>复合分区</p>
<div class="sourceCode"><pre class="sourceCode sql"><code class="sourceCode sql"><span class="kw">alter</span> <span class="kw">table</span> <span class="fu">user</span>
reorganize <span class="kw">partition</span> p1,p3 <span class="kw">into</span>
(<span class="kw">partition</span> p1 <span class="kw">values</span> <span class="kw">less</span> <span class="kw">than</span> (<span class="dv">1000</span>));</code></pre></div>

  			</div>
  			<hr />
			<div class="nav">
				<div class="pre"><a href="#"></a></div>
				<div class="next"><a href="#"></a></div>
			</div>
  		</div>
  	</div>
  	<div class="footer">
  		<ul>
  			<li>姓名:卡尔</li>
  			<li>QQ: 375694052</li>
  			<li>邮箱:375694052@qq.com</li>
  		</ul>
  	</div>
  </body>
</html>
