---
layout: post
comments: true
categories: 数据结构
title: 红黑树
tags: 红黑树,插入,删除
grammar_cjkRuby: true
author: kael
---

* content
{:toc}

## 前言

红黑树（Red Black Tree） 是一种自平衡二叉查找树，是在计算机科学中用到的一种数据结构，典型的用途是实现关联数组。

在JAVA中，许多跟排序有关的实现类都涉及到红黑树，最典型的如TreeMap。

本文主要就红黑树的特性和红黑树在插入和删除元素时的变化过程做详细的说明，以便帮助读者理解红黑树，当然，也方便自己记忆和查阅。

## 红黑树特性

红黑树有5个特性：

* 特性一：节点是红色或者是黑色；
* 特性二：根节点是黑色；
* 特性三：每个叶节点（NIL或空节点）是黑色；
* 特性四：每个红色节点的两个子节点都是黑色的（也就是说不存在两个连续的红色节点）； 
* 特性五：从任一节点到其没个叶节点的所有路径都包含相同数目的黑色节点；

在谈红黑树节点的插入和删除前，必须先彻底理解这五个特性。

### 特性一：节点是红色或者是黑色

这个特性其实非常好理解，就是树中的每个节点不是红色就是黑色，这也是红黑树的命名原因。
这里的节点是红色和黑色只是为了表明两种不同颜色的节点，实际上只是用来区分不同作用的节点而已，
你也可以用蓝色和黄色来标明，所以不需要纠结为什么是红色和黑色。

这个特性跟红黑树调整过程没有关系，基本不会被破坏，是最容易保持的。

### 特性二：根节点是黑色

根节点是黑色，这个特性实际上是一个比较自然的选择，可以提高红黑树在变化过程保持所有特性的性能，实际上即使没有这个特性，
红黑树也是能成立的，只是作为一个特性定义了根节点的颜色而已。

这个特性在红黑树调整过程可能被破坏：

* 在红黑树变化调整的过程中，有可能出现根节点的两个子节点都是黑色的情况，此时依然保持根节点为黑色即可。
* 在红黑树变化调整的过程中，也有可能出现根节点被调整成红色，同时根节点的两个子节点都是黑色的情况，此时也要将根节点调整为黑色。

### 特性三：每个叶节点（NIL或空节点）是黑色

这个特性可能看图会比较直观：

![红黑树]({{site.image_repo1}}/rb_tree/texing3.png)

从这里我们可以看到，所有叶子节点都是`NIL`，也就是空节点，并且都是黑色的。

在红黑树插入节点的过程中，插入的节点一定会替换已有的某个`NIL`节点，并且插入的节点也会同时自动附带左右两个`NIL`节点。

这个特性也是很好保持的，因为只要下面某个节点下面没有节点了，就等于有两个空节点，插入一个新节点时，肯定是成为某个节点的子节点，自然会替换掉原本为空的那个节点。

### 特性四：每个红色节点的两个子节点都是黑色的（也就是说不存在两个连续的红色节点）

这个特性指的是每一个红色的节点，它的两个子节点都不能是红色，也就是从根节点到叶子节点（`NIL`节点）的所有路径中，不会出现连续的红色节点。

这个特性非常容易被破坏，多数情况下插入节点和删除节点都会破坏这个特性。

### 特性五：从任一节点到其没个叶节点的所有路径都包含相同数目的黑色节点

这个特性也不是很好理解，如图：

![红黑树]({{site.image_repo1}}/rb_tree/texing3.png)

这里我们看到，从根节点开始，无论通过哪条路径到达`NIL`节点，经过的黑色节点数（包括`NIL`节点）是相同的，如：

```
13 -> 8 -> 1 -> NIL
13 -> 17 -> 25 -> 27 -> NIL
这两条路径，经过的黑色节点数都是3个，其他路径也必然都是3个。
```

这个特性也是非常容易被破坏的，多数情况下插入节点和删除节点都会破坏这个特性。

### 总结

从上面的特性我们可以总结如下几点：

* 总结一：特性一，二，三非常容易保持，在插入节点时，基本不会被破坏
* 总结二：黑色节点的两个子节点可以是黑色的，也就是从根节点到叶子节点（`NIL`节点）的路径中，可以出现连续的黑色节点；
* 总结三：插入节点时，如果新节点是黑色的，必然会破坏特性五，如果是红色的，则必然不会破坏规则五，但是有可能破坏规则四；

## 树的旋转




